$(function(){function t(){h=$("#user").val(),""!==h?o():($(".voter-column, .info-header").hide(),alert("Input user name."))}function e(t){t===!0?($(".voter-column, .info-header").hide(),$("body").before('<div class="overlay"></div><div class="pre-loader"></div>'),$(".dev-label").hide()):($(".dev-label").show(),$(".overlay, .pre-loader").remove(),$(".tooltip").tooltipster())}function o(){p(function(t){y=t,v(function(t){t.length>0?($("#profile_caption").text(h),b=t,d()):($(".voter-column, .info-header").hide(),$(".overlay, .pre-loader").remove(),alert("User not found."))})}),Promise.all([i()]).then(r).then(function(){n()}).then(function(){e(!1)})["catch"](function(t){$("#errors").html(t)})}function i(){return new Promise(function(t,e){steem.api.getDiscussionsByAuthorBeforeDate(h,"",O,A,function(o,i){null===o?(k=i,t(i)):e(o)})})}function r(){return F=[],C=0,new Promise(function(t,e){null!==k&&void 0!==k[0]&&(posts=k,posts.length>0?(posts.forEach(function(t){C+=c(t)}),posts.forEach(function(t){if(void 0!==t.active_votes&&t.active_votes.length>0){var e=l(t),o=c(t);t.active_votes.forEach(function(t){void 0===F[t.voter]?F[t.voter]={name:t.voter,rshares:t.rshares,upvote_power_perc:t.percent/100,cnt:1,upvote_reward:u(o,e,t.rshares)}:F[t.voter]={name:t.voter,rshares:1*F[t.voter].rshares+1*t.rshares,upvote_power_perc:((1*F[t.voter].upvote_power_perc+t.percent/100)/2).toFixed(2),cnt:++F[t.voter].cnt,upvote_reward:1*F[t.voter].upvote_reward+u(o,e,t.rshares)}})}}),steem.api.getAccounts(Object.keys(F),function(o,i){null===o?i.length>0&&i.forEach(function(t){t.name in F&&(F[t.name].avatar=s(t),F[t.name].reputation=g(t.reputation),F[t.name].link=j+"@"+t.name,F[t.name].curation_rate=(1*F[t.name].upvote_reward/C*100).toFixed(1))}):($("#errors").html(o),e(new Error(o))),t(F)})):e(new Error("You haven't any post")))})}function a(t){for(color in I)if(I[color].min<=1*t&&I[color].max>=1*t)return color}function n(){return new Promise(function(t,e){var o="";if(Object.keys(F).length>0){for(var i in F)if(F.hasOwnProperty(i)){var r=a(F[i].curation_rate)+"-palette",n=F[i].upvote_reward.toFixed(2),s=(1*F[i].reputation).toFixed(0),l=0==F[i].avatar?"img/blanc.png":"https://steemitimages.com/120x120/"+F[i].avatar,u=(1*F[i].upvote_power_perc).toFixed(0);o+='<div class="grid-item '+r+'" data-link="'+F[i].link+'" data-average_sp="'+u+'" data-upvotes_cnt="'+F[i].cnt+'" data-reward="'+n+'"><div class="grid-item-header"><div class="grid-item-header-text">'+F[i].name+'</div><div class="voter-reputation tooltip" title="Reputation of curator">'+s+'</div></div>  <div class="grid-item-body"><div class="grid-item-vote-cnt"><span class="upvotes-cnt tooltip" title="Quantity of posts uvoted by curator">'+F[i].cnt+'</span><span> of </span><span class="tooltip" title="Quantity of last created/updated posts">'+A+'</span></div><div class="grid-item-footer"><div class="tooltip" title="Average % of upvote for this curator"><div> Average Steem Power </div><div class="average-sp"> '+u+'% </div></div><div class="tooltip" title="SBD amount by this curator by last '+F[i].cnt+' posts"><div> Total SBD </div><div class="total-reward">'+n+'</div></div><div class="tooltip" title="Curator\'s share in rewards distribution by last'+F[i].cnt+' posts"><div class="total-upvotes-weight"> Total weight </div><div> '+F[i].curation_rate+'% </div></div></div></div> <div class="img-circle wrap-ava" style="background: url('+l+') no-repeat #ffffff; "></div><div class="img-circle wrap-ava-2" ></div></div>'}var c=""!==$(".grid").html()?!0:!1;$(".grid").html(o),c&&$(".grid").isotope("reloadItems"),$(".voter-column, .info-header").show(),D=$(".grid").isotope({itemSelector:".grid-item",percentPosition:!0,layoutMode:"fitRows",getSortData:{reward:"[data-reward] parseFloat",average_sp:"[data-average_sp] parseFloat",upvotes_cnt:"[data-upvotes_cnt] parseFloat"},sortBy:"reward",sortAscending:{reward:!1,upvotes_cnt:!1,average_sp:!1}})}t(1)})}function s(t){try{if("json_metadata"in t){var e=$.parseJSON(t.json_metadata);if("profile"in e&&"profile_image"in e.profile)return e.profile.profile_image}}catch(o){return!1}return!1}function l(t){if(t.abs_rshares>0)return t.abs_rshares;var e=0;return t.active_votes.forEach(function(t){e+=1*t.rshares}),e}function u(t,e,o){return 1*(o/e*t).toFixed(3)}function c(t){var e=t.pending_payout_value.split(" "),o=t.total_payout_value.split(" "),i=1*e[0]>0?1*e[0]:1*o[0];return i}function p(t){steem.api.getDynamicGlobalProperties(function(e,o){null===e?t(o):($("#errors").html(e),p(t))})}function v(t){steem.api.getAccounts([h],function(e,o){null===e?t(o):($("#errors").html(e),v(t))})}function d(){if(b.length>0){x=b[0].vesting_shares.split(" ")[0],$("#gests").html((x/1e6).toFixed(3)),$("#voting_power").html((b[0].voting_power/100).toFixed(2)+"%");var t=JSON.parse(b[0].json_metadata);void 0!==t.profile&&void 0!==t.profile.profile_image?$("#main-avatar").attr("style","background: url(https://steemitimages.com/120x120/"+t.profile.profile_image+") no-repeat;"):$("#main-avatar").attr("style","background: url(img/blanc.png)  no-repeat;"),$("#reputation").html(g(b[0].reputation)),null!==y&&(_=y.total_vesting_shares.split(" ")[0],w=y.total_vesting_fund_steem.split(" ")[0],$("#power").html((w*(x/_)).toFixed(3))),$("#power").html(m()),f()}}function f(){if(null!==y){var t=y.current_supply.split(" ")[0],e=t*B/100,o=m()/t,i=e*E/100;$(".profit-line-box #year-profit").text((i*o).toFixed(3)),$(".profit-line-box #month-profit").text((i*o*30/365).toFixed(3)),$(".profit-line-box #week-profit").text((i*o/52).toFixed(3)),$(".profit-line-box #day-profit").text((i*o/365).toFixed(3)),$(".profit-line-box #hour-profit").text((i*o/8760).toFixed(3))}}function m(){return null!==y?(_=y.total_vesting_shares.split(" ")[0],w=y.total_vesting_fund_steem.split(" ")[0],(w*(x/_)).toFixed(3)):0}function g(t){t+="",isNaN(t)&&(t=0);var e="-"===t.charAt(0);t=e?t.substr(1):t;var o=Math.log10(t);return o=Math.max(o-9,0),o=(e?-1:1)*o,o=9*o+25,o.toFixed(2)}var h,_,w,x,b=null,y=null,k=null,F=[],C=0,D=null,P=6e3,S=360,A=5,E=15,B=15,j="https://steemit.com/",I={black:{min:-100,max:-.1},grey:{min:0,max:.1},fog:{min:.11,max:1},sea:{min:1.1,max:5},green:{min:5.1,max:25},orange:{min:25.1,max:100}},M=new Date,O=M.getFullYear()+"-"+M.getMonth()+"-"+M.getDate()+"T"+M.getHours()+":"+M.getMinutes()+":"+M.getSeconds(),h=$("#user").val();$(".tooltip").tooltipster(),$(".settings-submit").on("click",function(){""!==$("#user").val()?(Cookies.set("user",$("#user").val(),{expires:S}),Cookies.set("post_count",$("#post_count").val(),{expires:S}),e(!0),t(),$(".settings-submit").hide()):alert("Input user name.")}),$("#user, #post_count").on("focus",function(){$(".settings-submit").show()}),$(".settings-submit").on("click",function(){$(this).hide()}),$("#user").on("change",function(){""!==$("#user").val()?(Cookies.set("user",$(this).val(),{expires:S}),e(!0),t()):alert("Input user name.")}),$("#filter_form .radio").on("click",function(){null!==D&&D.isotope({sortBy:[$(this).val(),"reward"]})}),"null"!==Cookies.get("user")&&void 0!==Cookies.get("user")&&$("#user").val(Cookies.get("user")),"null"!==Cookies.get("post_count")&&void 0!==Cookies.get("post_count")?$("#post_count").val(Cookies.get("post_count")):$("#post_count").val(A),$(".grid").on("click",".grid-item",function(){window.open($(this).data("link"),"_blank")}),""!==$("#user").val()&&(e(!0),t()),setInterval(function(){t()},1e3*P),$(".dev-label").on("click",function(){window.open("https://steemit.com/@elviento","_blank")})});