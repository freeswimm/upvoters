$(function(){function e(){""!==(O=$("#user").val())?r():($(".voter-column, .info-header").hide(),alert("Input user name."))}function t(e){!0===e?($(".voter-column, .info-header").hide(),$("body").before('<div class="overlay"></div><div class="pre-loader"></div>')):$(".overlay, .pre-loader").remove()}function r(){c(function(e){b=e,d(function(e){e.length>0?($("#profile_caption").text(O),w=e,p()):($(".voter-column, .info-header").hide(),$(".overlay, .pre-loader").remove(),alert("User not found."))})}),Promise.all([i()]).then(o).then(a).then(function(){t(!1)}).catch(function(e){$("#errors").html(e)})}function i(){return new Promise(function(e,t){steem.api.getDiscussionsByAuthorBeforeDate(O,"",M,P,function(r,i){null===r?(y=i,e(i)):t(r)})})}function o(){return k=[],F=0,new Promise(function(e,t){null!==y&&void 0!==y[0]&&(posts=y,posts.length>0?(posts.forEach(function(e){F+=u(e)}),posts.forEach(function(e){if(void 0!==e.active_votes&&e.active_votes.length>0){var t=l(e),r=u(e);e.active_votes.forEach(function(e){void 0===k[e.voter]?k[e.voter]={name:e.voter,rshares:e.rshares,upvote_power_perc:e.percent/100,cnt:1,upvote_reward:v(r,t,e.rshares)}:k[e.voter]={name:e.voter,rshares:1*k[e.voter].rshares+1*e.rshares,upvote_power_perc:((1*k[e.voter].upvote_power_perc+e.percent/100)/2).toFixed(2),cnt:++k[e.voter].cnt,upvote_reward:1*k[e.voter].upvote_reward+v(r,t,e.rshares)}})}}),steem.api.getAccounts(Object.keys(k),function(r,i){null===r?i.length>0&&i.forEach(function(e){e.name in k&&(k[e.name].avatar=s(e),k[e.name].link=E+"@"+e.name,k[e.name].curation_rate=(1*k[e.name].upvote_reward/F*100).toFixed(1))}):($("#errors").html(r),t(new Error(r))),e(k)})):t(new Error("You haven't any post")))})}function n(e){for(color in S)if(S[color].min<=1*e&&S[color].max>=1*e)return color}function a(){return new Promise(function(e,t){var r="";if(Object.keys(k).length>0){for(var i in k)if(k.hasOwnProperty(i)){var o=n(k[i].curation_rate)+"-palette",a=k[i].upvote_reward.toFixed(2),s=0==k[i].avatar?"img/blanc.png":"https://steemitimages.com/120x120/"+k[i].avatar,l=(1*k[i].upvote_power_perc).toFixed(0);r+='<div class="grid-item '+o+'" data-link="'+k[i].link+'" data-reward="'+a+'"><div class="grid-item-header"><div class="grid-item-header-text">'+k[i].name+'</div></div>  <div class="grid-item-body"><div class="grid-item-vote-cnt"><span class="upvotes-cnt">'+k[i].cnt+"</span><span>/</span><span>"+P+'</span></div><div class="grid-item-footer"><div><div> Average SP </div><div class="average-sp"> '+l+'% </div></div><div><div> Total SBD </div><div class="total-reward">'+a+'</div></div><div><div class="total-upvotes-weight"> Avg weight </div><div> '+k[i].curation_rate+'% </div></div></div></div> <div class="img-circle wrap-ava" style="background: url('+s+') no-repeat #ffffff; "></div><div class="img-circle wrap-ava-2" ></div></div>'}var v=""!==$(".grid").html();$(".grid").html(r),v&&$(".grid").isotope("reloadItems"),$(".voter-column, .info-header").show(),$(".grid").isotope({itemSelector:".grid-item",percentPosition:!0,layoutMode:"fitRows",getSortData:{reward:"[data-reward] parseFloat"},sortBy:"reward",sortAscending:{reward:!1}})}e(1)})}function s(e){try{if("json_metadata"in e){var t=$.parseJSON(e.json_metadata);if("profile"in t&&"profile_image"in t.profile)return t.profile.profile_image}}catch(e){return!1}return!1}function l(e){if(e.abs_rshares>0)return e.abs_rshares;var t=0;return e.active_votes.forEach(function(e){t+=1*e.rshares}),t}function v(e,t,r){return 1*(r/t*e).toFixed(3)}function u(e){var t=e.pending_payout_value.split(" "),r=e.total_payout_value.split(" ");return 1*t[0]>0?1*t[0]:1*r[0]}function c(e){steem.api.getDynamicGlobalProperties(function(t,r){null===t?e(r):($("#errors").html(t),c(e))})}function d(e){steem.api.getAccounts([O],function(t,r){null===t?e(r):($("#errors").html(t),d(e))})}function p(){if(w.length>0){x=w[0].vesting_shares.split(" ")[0],$("#gests").html((x/1e6).toFixed(3)),$("#voting_power").html((w[0].voting_power/100).toFixed(2)+"%");var e=JSON.parse(w[0].json_metadata);void 0!==e.profile&&void 0!==e.profile.profile_image?$("#main-avatar").attr("style","background: url(https://steemitimages.com/120x120/"+e.profile.profile_image+") no-repeat;"):$("#main-avatar").attr("style","background: url(img/blanc.png)  no-repeat;"),$("#reputation").html(g(w[0].reputation)),null!==b&&(h=b.total_vesting_shares.split(" ")[0],_=b.total_vesting_fund_steem.split(" ")[0],$("#power").html((_*(x/h)).toFixed(3))),$("#power").html(m()),f()}}function f(){if(null!==b){var e=b.current_supply.split(" ")[0],t=e*D/100,r=m()/e,i=t*A/100;$(".profit-line-box #year-profit").text((i*r).toFixed(3)),$(".profit-line-box #month-profit").text((i*r*30/365).toFixed(3)),$(".profit-line-box #week-profit").text((i*r/52).toFixed(3)),$(".profit-line-box #day-profit").text((i*r/365).toFixed(3)),$(".profit-line-box #hour-profit").text((i*r/8760).toFixed(3))}}function m(){return null!==b?(h=b.total_vesting_shares.split(" ")[0],((_=b.total_vesting_fund_steem.split(" ")[0])*(x/h)).toFixed(3)):0}function g(e){e+="",isNaN(e)&&(e=0);var t="-"===e.charAt(0);e=t?e.substr(1):e;var r=Math.log10(e);return r=Math.max(r-9,0),r*=t?-1:1,(r=9*r+25).toFixed(2)}var h,_,x,w=null,b=null,y=null,k=[],F=0,P=5,A=15,D=15,E="https://steemit.com/",S={black:{min:-100,max:-.1},grey:{min:0,max:.1},fog:{min:.11,max:1},sea:{min:1.1,max:5},green:{min:5.1,max:25},orange:{min:25.1,max:100}},j=new Date,M=j.getFullYear()+"-"+j.getMonth()+"-"+j.getDate()+"T"+j.getHours()+":"+j.getMinutes()+":"+j.getSeconds(),O=$("#user").val();$("#user").on("change",function(){""!==$("#user").val()?(Cookies.set("user",$(this).val(),{expires:360}),t(!0),e()):alert("Input user name.")}),"null"!==Cookies.get("user")&&void 0!==Cookies.get("user")&&$("#user").val(Cookies.get("user")),$(".grid").on("click",".grid-item",function(){window.open($(this).data("link"),"_blank")}),""!==$("#user").val()&&(t(!0),e()),setInterval(function(){e()},6e6),$(".dev-label").on("click",function(){window.open("https://steemit.com/@elviento","_blank")})});