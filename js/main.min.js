$(function(){function e(){""!==(O=$("#user").val())?o():($(".voter-column, .info-header").hide(),alert("Введите имя пользователя"))}function t(e){!0===e?($(".voter-column, .info-header").hide(),$("body").before('<div class="overlay"></div><div class="pre-loader"></div>')):$(".overlay, .pre-loader").remove()}function o(){d(function(e){b=e,u(function(e){e.length>0?($("#profile_caption").text(O),w=e,p()):($(".voter-column, .info-header").hide(),$(".overlay, .pre-loader").remove(),alert("Пользователь не найден"))})}),Promise.all([r()]).then(i).then(a).then(function(){t(!1)}).catch(function(e){$("#errors").html(e)})}function r(){return new Promise(function(e,t){steem.api.getDiscussionsByAuthorBeforeDate(O,"",M,E,function(o,r){null===o?(y=r,e(r)):t(o)})})}function i(){return k=[],F=0,new Promise(function(e,t){null!==y&&void 0!==y[0]&&(posts=y,posts.length>0?(posts.forEach(function(e){F+=c(e)}),posts.forEach(function(e){if(void 0!==e.active_votes&&e.active_votes.length>0){var t=v(e),o=c(e);e.active_votes.forEach(function(e){void 0===k[e.voter]?k[e.voter]={name:e.voter,rshares:e.rshares,upvote_power_perc:e.percent/100,cnt:1,upvote_reward:l(o,t,e.rshares)}:k[e.voter]={name:e.voter,rshares:1*k[e.voter].rshares+1*e.rshares,upvote_power_perc:((1*k[e.voter].upvote_power_perc+e.percent/100)/2).toFixed(2),cnt:++k[e.voter].cnt,upvote_reward:1*k[e.voter].upvote_reward+l(o,t,e.rshares)}})}}),steem.api.getAccounts(Object.keys(k),function(o,r){null===o?r.length>0&&r.forEach(function(e){e.name in k&&(k[e.name].avatar=s(e),k[e.name].link=S+"@"+e.name,k[e.name].curation_rate=(1*k[e.name].upvote_reward/F*100).toFixed(1))}):($("#errors").html(o),t(new Error(o))),e(k)})):t(new Error("У вас нет постов")))})}function n(e){for(color in j)if(j[color].min<=1*e&&j[color].max>=1*e)return color}function a(){return new Promise(function(e,t){var o="";if(Object.keys(k).length>0){for(var r in k)if(k.hasOwnProperty(r)){var i=n(k[r].curation_rate)+"-palette",a=k[r].upvote_reward.toFixed(2),s=0==k[r].avatar?"img/blanc.png":"https://imgp.golos.io/120x120/"+k[r].avatar,l=(1*k[r].upvote_power_perc).toFixed(0);o+='<div class="grid-item '+i+'" data-link="'+k[r].link+'" data-reward="'+a+'"><div class="grid-item-header"><div class="grid-item-header-text">'+k[r].name+'</div></div>  <div class="grid-item-body"><div class="grid-item-vote-cnt"><span class="upvotes-cnt">'+k[r].cnt+"</span><span>/</span><span>"+E+'</span></div><div class="grid-item-footer"><div><div> Средняя СГ </div><div class="average-sp"> '+l+'% </div></div><div><div> Всего GBG </div><div class="total-reward">'+a+'</div></div><div><div class="total-upvotes-weight"> Общий вес </div><div> '+k[r].curation_rate+'% </div></div></div></div> <div class="img-circle wrap-ava" style="background: url('+s+') no-repeat #ffffff; "></div><div class="img-circle wrap-ava-2" ></div></div>'}var v=""!==$(".grid").html();$(".grid").html(o),v&&$(".grid").isotope("reloadItems"),$(".voter-column, .info-header").show(),$(".grid").isotope({itemSelector:".grid-item",percentPosition:!0,layoutMode:"fitRows",getSortData:{reward:"[data-reward] parseFloat"},sortBy:"reward",sortAscending:{reward:!1}})}e(1)})}function s(e){try{if("json_metadata"in e){var t=$.parseJSON(e.json_metadata);if("profile"in t&&"profile_image"in t.profile)return t.profile.profile_image}}catch(e){return!1}return!1}function l(e,t,o){return 1*(o/t*e).toFixed(3)}function v(e){if("first_payout"==e.mode)return e.abs_rshares;var t=0;return e.active_votes.forEach(function(e){t+=1*e.rshares}),1*e.abs_rshares+t}function c(e){return 1*("first_payout"==e.mode?e.total_pending_payout_value:e.total_payout_value).split(" ")[0]}function d(e){steem.api.getDynamicGlobalProperties(function(t,o){null===t?e(o):($("#errors").html(t),d(e))})}function u(e){steem.api.getAccounts([O],function(t,o){null===t?e(o):($("#errors").html(t),u(e))})}function p(){if(w.length>0){x=w[0].vesting_shares.split(" ")[0],$("#gests").html((x/1e6).toFixed(3)),$("#voting_power").html((w[0].voting_power/100).toFixed(2)+"%");var e=JSON.parse(w[0].json_metadata);void 0!==e.profile&&void 0!==e.profile.profile_image?$("#main-avatar").attr("style","background: url(https://imgp.golos.io/120x120/"+e.profile.profile_image+") no-repeat;"):$("#main-avatar").attr("style","background: url(img/blanc.png)  no-repeat;"),$("#reputation").html(g(w[0].reputation)),null!==b&&(h=b.total_vesting_shares.split(" ")[0],_=b.total_vesting_fund_steem.split(" ")[0],$("#power").html((_*(x/h)).toFixed(3))),$("#power").html(m()),$("#level").html('<img src="https://imgp.golos.io/75x60/http://golosboard.com/@'+O+'/level.png"/>'),f()}}function f(){if(null!==b){var e=b.current_supply.split(" ")[0],t=e*D/100,o=m()/e,r=t*P/100;$(".profit-line-box #year-profit").text((r*o).toFixed(3)),$(".profit-line-box #month-profit").text((r*o/12).toFixed(3)),$(".profit-line-box #week-profit").text((r*o/52).toFixed(3)),$(".profit-line-box #day-profit").text((r*o/356).toFixed(3)),$(".profit-line-box #hour-profit").text((r*o/8544).toFixed(3))}}function m(){return null!==b?(h=b.total_vesting_shares.split(" ")[0],((_=b.total_vesting_fund_steem.split(" ")[0])*(x/h)).toFixed(3)):0}function g(e){e+="",isNaN(e)&&(e=0);var t="-"===e.charAt(0);e=t?e.substr(1):e;var o=Math.log10(e);return o=Math.max(o-9,0),o*=t?-1:1,(o=9*o+25).toFixed(2)}var h,_,x,w=null,b=null,y=null,k=[],F=0,E=5,P=15,D=15,S="https://golos.io/",j={black:{min:-100,max:-.1},grey:{min:0,max:.1},fog:{min:.11,max:1},sea:{min:1.1,max:5},green:{min:5.1,max:25},orange:{min:25.1,max:100}},A=new Date,M=A.getFullYear()+"-"+A.getMonth()+"-"+A.getDate()+"T"+A.getHours()+":"+A.getMinutes()+":"+A.getSeconds(),O=$("#user").val();steem.api.setWebSocket("wss://ws.golos.io"),$("#user").on("change",function(){""!==$("#user").val()?(Cookies.set("user",$(this).val(),{expires:360}),t(!0),e()):alert("Введите имя пользователя.")}),"null"!==Cookies.get("user")&&void 0!==Cookies.get("user")&&$("#user").val(Cookies.get("user")),$(".grid").on("click",".grid-item",function(){window.open($(this).data("link"),"_blank")}),""!==$("#user").val()&&(t(!0),e()),setInterval(function(){e()},6e6),$(".dev-label").on("click",function(){window.open("https://golos.io/@elviento","_blank")})});